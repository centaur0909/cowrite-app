import streamlit as st
import pandas as pd
from datetime import datetime
import pytz

# ---------------------------
# 1. ãƒšãƒ¼ã‚¸è¨­å®š & ä½™è¨ˆãªè¡¨ç¤ºã‚’æ¶ˆã™CSS
# ---------------------------
st.set_page_config(page_title="Co-Write Sprinter", page_icon="ğŸ¦", layout="centered")

# å³ä¸Šã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚„ä¸‹ã®ãƒ•ãƒƒã‚¿ãƒ¼ã‚’éš ã™é­”æ³•ã®CSS
hide_streamlit_style = """
            <style>
            #MainMenu {visibility: hidden;}
            footer {visibility: hidden;}
            header {visibility: hidden;}
            /* ãƒ‡ãƒƒãƒ‰ãƒ©ã‚¤ãƒ³ã®æ–‡å­—ã‚µã‚¤ã‚ºèª¿æ•´ */
            .big-font {
                font-size:20px !important;
                font-weight: bold;
                color: #FF4B4B;
            }
            </style>
            """
st.markdown(hide_streamlit_style, unsafe_allow_html=True)

# ---------------------------
# 2. ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæ™‚é–“è¨ˆç®—ï¼‰
# ---------------------------
DEADLINE = datetime(2026, 1, 14, 23, 59, 0, tzinfo=pytz.timezone('Asia/Tokyo'))
now = datetime.now(pytz.timezone('Asia/Tokyo'))
diff = DEADLINE - now

# ---------------------------
# 3. ãƒ¡ã‚¤ãƒ³ç”»é¢ï¼šãƒ‡ãƒƒãƒ‰ãƒ©ã‚¤ãƒ³è¡¨ç¤ºï¼ˆæœ€å„ªå…ˆï¼ï¼‰
# ---------------------------
# ã‚¹ãƒãƒ›ã§ä¸€ç•ªæœ€åˆã«è¦‹ã‚‹ã¹ãæƒ…å ±ã¯ã“ã‚Œï¼
if diff.total_seconds() > 0:
    days = diff.days
    hours = diff.seconds // 3600
    minutes = (diff.seconds % 3600) // 60
    
    # è¦–è¦šçš„ã«ã‚ã‹ã‚Šã‚„ã™ããƒãƒ¼ã§è¡¨ç¤º
    progress_val = max(0, min(100, int((1 - diff.total_seconds() / (7*24*60*60)) * 100)))
    
    # æ–‡å­—ã§è¡¨ç¤ºï¼ˆã‚«ã‚¹ã‚¿ãƒ HTMLã§ã‚µã‚¤ã‚ºåˆ¶å¾¡ï¼‰
    st.markdown(f'<p class="big-font">ğŸ”¥ DEADLINEã¾ã§ï¼šã‚ã¨ {hours}æ™‚é–“ {minutes}åˆ†</p>', unsafe_allow_html=True)
    st.progress(progress_val)
else:
    st.error("ğŸš¨ ç· ã‚åˆ‡ã‚Šéãã¦ã¾ã™ï¼ï¼æå‡ºæ€¥ã’ï¼ï¼")

st.write("---") # åŒºåˆ‡ã‚Šç·š

# ---------------------------
# 4. ã‚¿ã‚¹ã‚¯ç®¡ç†ãƒœãƒ¼ãƒ‰
# ---------------------------
st.subheader("ğŸš€ åˆ¶ä½œé€²è¡Œãƒœãƒ¼ãƒ‰") # ã‚¿ã‚¤ãƒˆãƒ«ã‚µã‚¤ã‚ºã‚’å°‘ã—å°ã•ã

# ã‚¿ãƒ–ã‚’ä½œã‚‹
tab1, tab2, tab3 = st.tabs(["1. Pose", "2. Masterpiece", "3. Runner"])

def task_list(song_name, task_data):
    st.markdown(f"**ğŸµ {song_name}**") # æ›²ã‚¿ã‚¤ãƒˆãƒ«ã‚‚å°‘ã—å°ã•ãå¤ªå­—ã§
    
    # å®Œäº†æ•°ã‚«ã‚¦ãƒ³ãƒˆ
    done_count = 0
    total_tasks = len(task_data)
    
    for task_name, info in task_data.items():
        # æ‹…å½“è€…ã‚¢ã‚¤ã‚³ãƒ³
        person_icon = "ğŸ¦" if info["person"] == "miyoshi" else "ğŸ‘¤"
        label = f"{person_icon} {task_name}"
        
        # ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
        checked = st.checkbox(label, value=info["done"], key=f"{song_name}_{task_name}")
        if checked:
            done_count += 1
            
    # é€²æ—ç‡
    if total_tasks > 0:
        progress = done_count / total_tasks
        st.caption(f"é€²æ—: {int(progress * 100)}%")
        st.progress(progress)

# --- æ›²ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆã“ã“ã‚’æ›¸ãæ›ãˆã‚Œã°ã‚¿ã‚¹ã‚¯ãŒå¤‰ã‚ã‚Šã¾ã™ï¼‰ ---

# 1æ›²ç›®
tasks_1 = {
    "ã‚®ã‚¿ãƒ¼æœ¬ç•ªéŒ²éŸ³": {"person": "miyoshi", "done": True},
    "ã‚µãƒ“æ§‹æˆå¤‰æ›´": {"person": "umezawa", "done": True},
    "ãƒŸãƒƒã‚¯ã‚¹æœ€çµ‚ç¢ºèª": {"person": "umezawa", "done": False}
}

# 2æ›²ç›®
tasks_2 = {
    "æ­Œãƒ‡ãƒ¼ã‚¿é€ä¿¡": {"person": "miyoshi", "done": True},
    "ãƒ–ãƒ©ã‚¹è¿½åŠ ãƒ»Mix": {"person": "umezawa", "done": False},
}

# 3æ›²ç›®
tasks_3 = {
    "ã‚¢ãƒ¬ãƒ³ã‚¸æå‡º": {"person": "umezawa", "done": False},
    "ãƒœãƒ¼ã‚«ãƒ«Rec": {"person": "miyoshi", "done": False},
    "BPM/Keyå›ºå®šç¢ºèª": {"person": "miyoshi", "done": True},
}

with tab1:
    task_list("Pose & Gimmick", tasks_1)

with tab2:
    task_list("çµ¶å¯¾çš„ãƒã‚¹ã‚¿ãƒ¼ãƒ”ãƒ¼ã‚¹ï¼", tasks_2)

with tab3:
    task_list("GO! GO! RUNNER!", tasks_3)

st.markdown("---")
st.caption("Auto-generated by Gemini")
